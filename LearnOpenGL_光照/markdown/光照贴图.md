
ğŸ‘€ çœ‹è¿‡æ¥ï¼ä»Šå¤©æ•™ä½ å†è¿›ä¸€æ­¥ï¼Œè®©Dç‰©ä½“æ›´æ›´æ›´çœŸå®ã€‚ä»Šå¤©å’±ä»¬æ¥èŠä¸€èŠ OpenGL ä¸­çš„å…‰ç…§è´´å›¾ï¼

## 1. ä¸ºå•¥è¦æå…‰ç…§è´´å›¾ï¼Ÿ

å‰é¢æˆ‘ä»¬å­¦ç»™ç‰©ä½“åŠ æè´¨ï¼Œè®©ä¸åŒç‰©ä½“å¯¹å…‰ç…§æœ‰ä¸åŒååº”ã€‚ä½†é—®é¢˜æ˜¯ï¼Œç°å®ä¸­çš„ç‰©ä½“ä¸€ä¸ªæ¯”ä¸€ä¸ªå¤æ‚ï¼Œå…‰é ä¹‹å‰é‚£ç§ç»™æ•´ä¸ªç‰©ä½“ä¸€ä¸ªç»Ÿä¸€æè´¨çš„æ–¹æ³•ï¼Œæ ¹æœ¬ä¸å¤Ÿçœ‹ã€‚åƒä¸€è¾†è½¦ï¼Œè½¦å¤–å£³è´¼äº®ï¼Œè½®èƒæ²¡å•¥é«˜å…‰ï¼Œè½®æ¯‚åˆç‰¹åˆ«é—ªã€‚è¦æ˜¯è¿˜ç”¨ä¹‹å‰é‚£å¥—ï¼Œæ•´ä¸ªè½¦çš„æè´¨éƒ½ä¸€æ ·ï¼Œé‚£çœ‹èµ·æ¥å¾—å¤šå‡ï¼Ÿ
æ‰€ä»¥ï¼Œå…‰ç…§è´´å›¾å°±æ¥äº†ï¼å®ƒèƒ½è®©ä½ å¯¹ç‰©ä½“çš„æ¼«åå°„ï¼ˆdiffuseï¼‰å’Œé•œé¢åå°„ï¼ˆspecularï¼‰æˆåˆ†è¿›è¡Œæ›´ç²¾ç¡®çš„æ§åˆ¶ã€‚

## 2. æ¼«åå°„è´´å›¾ï¼ˆDiffuse textureï¼‰

æ¼«åå°„è´´å›¾å…¶å®å°±æ˜¯ç»™ç‰©ä½“è´´ä¸€å¼  "çº¹ç†"ï¼Œè®©æ¯ä¸ªåƒç´ ç‚¹çš„æ¼«åå°„é¢œè‰²éƒ½ä¸ä¸€æ ·ã€‚

ä¸‹é¢æˆ‘ä»¬å°†ç”¨ä¸‹é¢çš„å›¾ï¼Œè´´åˆ°ç®±å­ä¸Šï¼Œæ¥å®æˆ˜ä¸€ä¸‹ã€‚

![alt text](image-14.png)

### 2.1 ä¿®æ”¹ç‰‡æ®µç€è‰²å™¨

åŸæ¥çš„ç‰‡æ®µç€è‰²å™¨æè´¨å±æ€§ï¼š

```glsl
struct Material {
    vec3 ambient;
    vec3 diffuse;
    vec3 specular;
    float shininess;
};
```

å¯ä»¥çœ‹åˆ°ï¼Œæ¼«åå°„å±æ€§diffuseæ˜¯ä¸€ä¸ªå›ºå®šå€¼ï¼Œåœ¨ç‰©ä½“ä¸Šçš„æ¯ä¸€ç‚¹éƒ½æ˜¯åŒä¸€ä¸ªé¢œè‰²ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬è¦å°†æ¼«åå°„å±æ€§æ”¹æˆçº¹ç†å±æ€§ï¼š

```glsl
struct Material {
    sampler2D diffuse;
    vec3 specular;
    float shininess;
};
```

ç„¶ååŠ ä¸€ä¸ªå˜é‡æ¥æ”¶çº¹ç†åæ ‡ï¼š

```glsl
in vec2 TexCoords;
```

> ä¸Šé¢æˆ‘ä»¬è¿˜å°† ambientå±æ€§ ç»™åˆ é™¤äº†ã€‚å› ä¸ºambienté¢œè‰²ç»å¤§å¤šæ•°æƒ…å†µç­‰äºdiffuseé¢œè‰²ï¼Œæ‰€ä»¥ä¸éœ€è¦åˆ†åˆ«å»å‚¨å­˜å®ƒã€‚ï¼ˆå…ˆè®°ä½è¿™ä¸ªç»“è®ºå§ï¼Œè‡³äºä¸ºä»€ä¹ˆäºŒè€…ç›¸ç­‰ï¼Œåé¢å†è¯´ï¼‰

æœ‰äº†çº¹ç†ï¼Œæˆ‘ä»¬ç»§ç»­ä¿®æ”¹æ¼«åå°„æœ€ç»ˆé¢œè‰²çš„è®¡ç®—ï¼š

```glsl
vec3 diffuse = vec3(texture(material.diffuse, TexCoords)) * diff * light.diffuse;
```

åŒæ—¶ï¼Œå› ä¸ºæˆ‘ä»¬åˆ é™¤äº† ambient å±æ€§ï¼Œæ‰€ä»¥ambientçš„è®¡ç®—ä¹Ÿè¦ç”¨çº¹ç†æ¥è®¡ç®—ï¼š

```glsl
vec3 ambient = vec3(texture(material.diffuse, TexCoords)) * light.ambient;
```

### 2.2 ä¿®æ”¹é¡¶ç‚¹ç€è‰²å™¨

é¡¶ç‚¹ç€è‰²å™¨éœ€è¦å°†çº¹ç†åæ ‡ä¼ ç»™ç‰‡æ®µç€è‰²å™¨ï¼š

```glsl
......
layout (location = 2) in vec2 texCoords;
out vec2 TexCoords;

......
TexCoords = texCoords;
```

### 2.3 çº¹ç†èµ‹å€¼

åœ¨ä¸»ç¨‹åºä¸­ï¼Œå°†çº¹ç†è®¾ç½®ç»™ç€è‰²å™¨ï¼š

ï¼ˆ1ï¼‰é¦–å…ˆä¿®æ”¹é¡¶ç‚¹æ•°ç»„

å› ä¸ºæˆ‘ä»¬æ–°å¢äº†çº¹ç†åæ ‡ï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹é¡¶ç‚¹æ•°ç»„ï¼š

```cpp
// Positions          // Normals           // Texture Coords
-0.5f, -0.5f, -0.5f,  0.0f,  0.0f, -1.0f,  0.0f,  0.0f,
0.5f, -0.5f, -0.5f,  0.0f,  0.0f, -1.0f,  1.0f,  0.0f,
0.5f,  0.5f, -0.5f,  0.0f,  0.0f, -1.0f,  1.0f,  1.0f,
0.5f,  0.5f, -0.5f,  0.0f,  0.0f, -1.0f,  1.0f,  1.0f,
-0.5f,  0.5f, -0.5f,  0.0f,  0.0f, -1.0f,  0.0f,  1.0f,
-0.5f, -0.5f, -0.5f,  0.0f,  0.0f, -1.0f,  0.0f,  0.0f,

-0.5f, -0.5f,  0.5f,  0.0f,  0.0f,  1.0f,  0.0f,  0.0f,
0.5f, -0.5f,  0.5f,  0.0f,  0.0f,  1.0f,  1.0f,  0.0f,
0.5f,  0.5f,  0.5f,  0.0f,  0.0f,  1.0f,  1.0f,  1.0f,
0.5f,  0.5f,  0.5f,  0.0f,  0.0f,  1.0f,  1.0f,  1.0f,
-0.5f,  0.5f,  0.5f,  0.0f,  0.0f,  1.0f,  0.0f,  1.0f,
-0.5f, -0.5f,  0.5f,  0.0f,  0.0f,  1.0f,  0.0f,  0.0f,

-0.5f,  0.5f,  0.5f, -1.0f,  0.0f,  0.0f,  1.0f,  0.0f,
-0.5f,  0.5f, -0.5f, -1.0f,  0.0f,  0.0f,  1.0f,  1.0f,
-0.5f, -0.5f, -0.5f, -1.0f,  0.0f,  0.0f,  0.0f,  1.0f,
-0.5f, -0.5f, -0.5f, -1.0f,  0.0f,  0.0f,  0.0f,  1.0f,
-0.5f, -0.5f,  0.5f, -1.0f,  0.0f,  0.0f,  0.0f,  0.0f,
-0.5f,  0.5f,  0.5f, -1.0f,  0.0f,  0.0f,  1.0f,  0.0f,

0.5f,  0.5f,  0.5f,  1.0f,  0.0f,  0.0f,  1.0f,  0.0f,
0.5f,  0.5f, -0.5f,  1.0f,  0.0f,  0.0f,  1.0f,  1.0f,
0.5f, -0.5f, -0.5f,  1.0f,  0.0f,  0.0f,  0.0f,  1.0f,
0.5f, -0.5f, -0.5f,  1.0f,  0.0f,  0.0f,  0.0f,  1.0f,
0.5f, -0.5f,  0.5f,  1.0f,  0.0f,  0.0f,  0.0f,  0.0f,
0.5f,  0.5f,  0.5f,  1.0f,  0.0f,  0.0f,  1.0f,  0.0f,

-0.5f, -0.5f, -0.5f,  0.0f, -1.0f,  0.0f,  0.0f,  1.0f,
0.5f, -0.5f, -0.5f,  0.0f, -1.0f,  0.0f,  1.0f,  1.0f,
0.5f, -0.5f,  0.5f,  0.0f, -1.0f,  0.0f,  1.0f,  0.0f,
0.5f, -0.5f,  0.5f,  0.0f, -1.0f,  0.0f,  1.0f,  0.0f,
-0.5f, -0.5f,  0.5f,  0.0f, -1.0f,  0.0f,  0.0f,  0.0f,
-0.5f, -0.5f, -0.5f,  0.0f, -1.0f,  0.0f,  0.0f,  1.0f,

-0.5f,  0.5f, -0.5f,  0.0f,  1.0f,  0.0f,  0.0f,  1.0f,
0.5f,  0.5f, -0.5f,  0.0f,  1.0f,  0.0f,  1.0f,  1.0f,
0.5f,  0.5f,  0.5f,  0.0f,  1.0f,  0.0f,  1.0f,  0.0f,
0.5f,  0.5f,  0.5f,  0.0f,  1.0f,  0.0f,  1.0f,  0.0f,
-0.5f,  0.5f,  0.5f,  0.0f,  1.0f,  0.0f,  0.0f,  0.0f,
-0.5f,  0.5f, -0.5f,  0.0f,  1.0f,  0.0f,  0.0f,  1.0f
```

ï¼ˆ2ï¼‰ä¿®æ”¹é¡¶ç‚¹å±æ€§ç»‘å®š

é¡¶ç‚¹æ•°ç»„å˜åŒ–äº†ï¼Œç´§æ¥ç€è¦è®°å¾—ä¿®æ”¹å¯¹åº”çš„é¡¶ç‚¹å±æ€§ç»‘å®šï¼š

```cpp
glVertexAttribPointer(0, 3, GL_FLOAT, GL_FALSE, 8 * sizeof(float), (void*)0);
glEnableVertexAttribArray(0);
glVertexAttribPointer(1, 3, GL_FLOAT, GL_FALSE, 8 * sizeof(float), (void*)(3 * sizeof(GLfloat)));
glEnableVertexAttribArray(1);
glVertexAttribPointer(2, 2, GL_FLOAT, GL_FALSE, 8 * sizeof(float), (void*)(6 * sizeof(GLfloat)));
glEnableVertexAttribArray(2);
```

ï¼ˆ3ï¼‰åŠ è½½çº¹ç†

å¤ä¹ ä¸€ä¸‹åŠ è½½çº¹ç†çš„æ­¥éª¤ï¼š

- åˆ›å»ºçº¹ç†ID: glGenTextures
- ç»‘å®šçº¹ç†: glBindTexture
- é…ç½®çº¹ç†å‚æ•°: glTexParameteri
- åŠ è½½çº¹ç†å›¾ç‰‡: stbi_load
- ç”Ÿæˆçº¹ç†: glTexImage2D
- è§£é™¤ç»‘å®š: glBindTexture

```cpp
unsigned int diffuseMap;
glGenTextures(1, &diffuseMap);
int width, height, nrChannels;
std::string filePath = PROJECT_PATH + "/resource/container2.png";
unsigned char *data = stbi_load(filePath.c_str(), &width, &height, &nrChannels, 0);
glBindTexture(GL_TEXTURE_2D, diffuseMap);
glTexImage2D(GL_TEXTURE_2D, 0, GL_RGB, width, height, 0, GL_RGB, GL_UNSIGNED_BYTE, data);
glGenerateMipmap(GL_TEXTURE_2D);
stbi_image_free(data);
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_REPEAT);   
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_REPEAT);
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR);
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);
glBindTexture(GL_TEXTURE_2D, 0);
```

ï¼ˆ4ï¼‰å°†çº¹ç†ä¼ é€’ç»™ç€è‰²å™¨

```cpp
ourShader.use();
ourShader.setInt("material.diffuse", 0);
```

ï¼ˆ5ï¼‰æ¯æ¬¡æ¸²æŸ“æ—¶ï¼Œæ¿€æ´»çº¹ç†å•å…ƒå¹¶ç»‘å®šçº¹ç†ï¼š

```cpp
glActiveTexture(GL_TEXTURE0);
glBindTexture(GL_TEXTURE_2D, diffuseMap);
```

### 2.4 è¿è¡Œæ•ˆæœ

![alt text](image-15.png)

## 3. é•œé¢è´´å›¾: è®©ç‰©ä½“æœ‰çš„åœ°æ–¹è´¼äº®ï¼Œæœ‰çš„åœ°æ–¹ä¸äº®

é•œé¢è´´å›¾èƒ½è®©ä½ æ§åˆ¶ç‰©ä½“å“ªäº›åœ°æ–¹æœ‰é•œé¢é«˜å…‰ï¼Œå“ªäº›åœ°æ–¹æ²¡æœ‰ã€‚æ¯”å¦‚è¿™ä¸ªæœ¨ç®±å­ï¼Œæœ¨å¤´éƒ¨åˆ†æ²¡å•¥é«˜å…‰ï¼Œä½†é’¢è¾¹å¾—æœ‰é«˜å…‰ã€‚è¿™æ—¶å€™é•œé¢è´´å›¾å°±æ´¾ä¸Šç”¨åœºäº†ã€‚

é•œé¢è´´å›¾ä¸€èˆ¬æ˜¯é»‘ç™½çš„ï¼Œé»‘è‰²ä»£è¡¨æ²¡é«˜å…‰ï¼Œç™½è‰²ä»£è¡¨æœ‰é«˜å…‰ã€‚ä½ ä¹Ÿå¯ä»¥ç”¨å…¶ä»–é¢œè‰²ï¼Œä¸è¿‡ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé«˜å…‰é¢œè‰²ä¸»è¦è¿˜æ˜¯çœ‹å…‰æºé¢œè‰²ï¼Œæ‰€ä»¥é»‘ç™½çš„å°±å¤Ÿç”¨äº†ã€‚ä¾‹å¦‚ä¸‹é¢çš„è¿™å¼ å›¾å°±æœ€ä¸ºé•œé¢è´´å›¾æ¥ç”¨ï¼š

![alt text](image-16.png)

> ä½¿ç”¨Photoshopæˆ–Gimpä¹‹ç±»çš„å·¥å…·ï¼Œé€šè¿‡å°†å›¾ç‰‡è¿›è¡Œè£å‰ªï¼Œå°†æŸéƒ¨åˆ†è°ƒæ•´æˆé»‘ç™½å›¾æ ·ï¼Œå¹¶è°ƒæ•´äº®åº¦/å¯¹æ¯”åº¦çš„åšæ³•ï¼Œå¯ä»¥éå¸¸å®¹æ˜“å°†ä¸€ä¸ªdiffuseçº¹ç†è´´å›¾å¤„ç†ä¸ºspecularè´´å›¾ã€‚

åœ¨ä»£ç é‡Œï¼Œé•œé¢è´´å›¾çš„ç”¨æ³•å’Œæ¼«åå°„è´´å›¾å·®ä¸å¤šã€‚

### 3.1 ä¿®æ”¹ç‰‡æ®µç€è‰²å™¨

ï¼ˆ1ï¼‰ä¿®æ”¹æè´¨å±æ€§ï¼Œå°† specular å±æ€§æ”¹ä¸ºçº¹ç†ç±»å‹

```glsl
struct Material {
    sampler2D diffuse;
    sampler2D specular;
    float shininess;
};
```

ï¼ˆ2ï¼‰ä¿®æ”¹specularå…‰ç…§çš„è®¡ç®—ï¼š

```glsl
vec3 specular = vec3(texture(material.specular, TexCoords)) * spec * light.specular;
```


### 3.2 ä¿®æ”¹é¡¶ç‚¹ç€è‰²å™¨

çº¹ç†åæ ‡ä½¿ç”¨åŒä¸€ä¸ªï¼Œæ‰€ä»¥é¡¶ç‚¹ç€è‰²å™¨è¿™é‡Œä¸ç”¨ä¿®æ”¹ã€‚

### 3.3 ä¿®æ”¹çº¹ç†èµ‹å€¼

ï¼ˆ1ï¼‰çº¹ç†åæ ‡å¯ä»¥ç›´æ¥ç”¨diffuseçº¹ç†åæ ‡ï¼Œæ‰€ä»¥é¡¶ç‚¹æ•°ç»„ä¸ç”¨åŠ¨ï¼Œé¡¶ç‚¹å±æ€§ç»‘å®šä¹Ÿä¸ç”¨åŠ¨ã€‚

ï¼ˆ2ï¼‰åŠ è½½çº¹ç†

```cpp
unsigned int specularMap;
glGenTextures(1, &specularMap);
int width, height, nrChannels;
std::string filePath = PROJECT_PATH + "/resource/container2_border.png";
unsigned char *data = stbi_load(filePath.c_str(), &width, &height, &nrChannels, 0);
glBindTexture(GL_TEXTURE_2D, specularMap);
glTexImage2D(GL_TEXTURE_2D, 0, GL_RGB, width, height, 0, GL_RGB, GL_UNSIGNED_BYTE, data);
glGenerateMipmap(GL_TEXTURE_2D);
stbi_image_free(data);
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_REPEAT);   
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_REPEAT);
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR);
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);
glBindTexture(GL_TEXTURE_2D, 0);
```

ï¼ˆ3ï¼‰å°†çº¹ç†ä¼ é€’ç»™ç€è‰²å™¨

```cpp
ourShader.setInt("material.specular", 1);
```

ï¼ˆ4ï¼‰æ¯æ¬¡æ¸²æŸ“æ—¶ï¼Œæ¿€æ´»çº¹ç†å•å…ƒå¹¶ç»‘å®šçº¹ç†ï¼š

```cpp
glActiveTexture(GL_TEXTURE1);
glBindTexture(GL_TEXTURE_2D, specularMap);
```

### 3.4 è¿è¡Œæ•ˆæœ

![alt text](image-17.png)

## 4. æ€»ç»“

æ¼«åå°„è´´å›¾è®©ç‰©ä½“é¢œè‰²ä¸°å¯Œèµ·æ¥ï¼Œé•œé¢è´´å›¾åˆ™è®©ç‰©ä½“çš„é«˜å…‰ç»†èŠ‚æ›´é€¼çœŸã€‚å…‰ç…§è´´å›¾åªæ˜¯çº¹ç†è´´å›¾çš„ä¸€ç§ï¼Œè¿˜æœ‰æ³•çº¿è´´å›¾ã€å‡¹å‡¸è´´å›¾ã€åå°„è´´å›¾ç­‰ç­‰ï¼Œå¯ä»¥ç»™ç‰©ä½“æ·»åŠ æ›´å¤šç»†èŠ‚ã€‚







